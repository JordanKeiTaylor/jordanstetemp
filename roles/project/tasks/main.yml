---
- name: Check project dir exists
  file:
    dest: ~/project
    state: directory

- name: Extract project
  unarchive:
    src: project.tar.gz
    dest: ~/project
- name: Copy docker-compose.yml
  copy:
    src: docker-compose.yml
    dest: ~/project
- name: Copy .env file
  copy:
    src: .env
    dest: ~/project

- name: "[HACK] Create gsim dir"
  file:
    dest: ~/project/build/assembly/gsim
    state: directory

- name: Create fabric bundle dir
  file:
    dest: ~/project/build/assembly/fabric
    state: directory

- name: Copy fabric bundle
  copy:
    src: fabric_bundle.zip
    dest: ~/project/build/assembly/fabric

# TODO: The nodes should probably be tracked in ansible config
- shell: cd ~/project && docker-compose config --services 2>/dev/null | grep fabric
  register: fabric_svcs

- name: Copy prometheus.yml
  copy:
    src: prometheus.yml
    dest: ~/project/

- name: Create scrape_config
  template:
    src: scrape_config.yml.j2
    dest: ~/scrape_config.yml

